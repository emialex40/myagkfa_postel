/**
 *---------------------------------------------------------------------------------------
 * @package      VP One Page Checkout - Joomla! System Plugin
 * @subpackage   For VirtueMart 3+
 *---------------------------------------------------------------------------------------
 * @copyright    Copyright (C) 2012-2017 VirtuePlanet Services LLP. All rights reserved.
 * @license      GNU General Public License version 2 or later; see LICENSE.txt
 * @authors      Abhishek Das
 * @email        info@virtueplanet.com
 * @link         https://www.virtueplanet.com
 *---------------------------------------------------------------------------------------
 * $Revision: 106 $
 * $LastChangedDate: 2017-01-23 17:46:39 +0530 (Mon, 23 Jan 2017) $
 * $Id: plugin.min.js 106 2017-01-23 12:16:39Z abhishekdas $
 * --------------------------------------------------------------------------------------
 */
VPOPC=window.VPOPC||{},ProOPC=window.ProOPC||{},VPOPC.options={},VPOPC.loadOptions=function(a){for(var b in a)this.options[b]=a[b];return this},VPOPC._=function(a,b){return b="undefined"!=typeof b&&"undefined"!=typeof b&&b,"undefined"!=typeof this.options[a.toUpperCase()]&&"undefined"!=typeof this.options[a.toUpperCase()]?this.options[a.toUpperCase()]:b},VPOPC.JText={strings:{},_:function(a,b){return b="undefined"==typeof b||"undefined"==typeof b?null:b,"undefined"!=typeof this.strings[a.toUpperCase()]&&"undefined"!=typeof this.strings[a.toUpperCase()]?this.strings[a.toUpperCase()]:b},sprintf:function(a,b){b="undefined"==typeof b||"undefined"==typeof b?null:b;var c="undefined"!=typeof this.strings[a.toUpperCase()]&&"undefined"!=typeof this.strings[a.toUpperCase()]?this.strings[a.toUpperCase()]:"";return c.replace("%s",b)},load:function(a){for(var b in a)this.strings[b.toUpperCase()]=a[b];return this}},ProOPC.jQuery=jQuery.noConflict(),function(a,b,c){ProOPC.ajaxPool={},ProOPC.cache={},ProOPC.init=function(b){if(b=ProOPC.hasValue(b),b&&navigator.userAgent.match(/IEMobile\/10\.0/)){var c=document.createElement("style");c.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.getElementsByTagName("head")[0].appendChild(c)}a("#ProOPC .proopc-btn").each(function(){var c=a(this).attr("onclick"),d=a(this).attr("id"),d=d?a.trim(d):"",e=a(this).data("proopcReady");c&&c.indexOf("ProOPC.")>=0&&!e&&(a(this).click(function(a){return a.preventDefault(),c.indexOf("updateproductqty")>=0?ProOPC.updateproductqty(this):c.indexOf("deleteproduct")>=0?ProOPC.deleteproduct(this):c.indexOf("guestcheckout")>=0?ProOPC.guestcheckout(this):c.indexOf("registerCheckout")>=0?ProOPC.registerCheckout(this):c.indexOf("loginAjax")>=0?ProOPC.loginAjax(this):c.indexOf("submitOrder")>=0?ProOPC.submitOrder(this):c.indexOf("savecoupon")>=0?ProOPC.savecoupon(this):void 0}).data("proopcReady",!0).removeAttr("onclick"),(b||c.indexOf("submitOrder")<0)&&a(this).removeAttr("disabled"),e=a(this).data("proopcReady")),"proopc-task-guestcheckout"!=d||e?"proopc-task-registercheckout"!=d||e?"proopc-task-loginajax"!=d||e?"proopc-order-submit"!=d||e?"proopc-task-savecoupon"!=d||e?a(this).hasClass("proopc-task-updateqty")&&!e?a(this).click(function(a){return a.preventDefault(),ProOPC.updateproductqty(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).hasClass("proopc-task-deleteproduct")&&!e&&a(this).click(function(a){return a.preventDefault(),ProOPC.deleteproduct(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).click(function(a){return a.preventDefault(),ProOPC.savecoupon(this)}).data("proopcReady",!0).removeAttr("disabled"):(a(this).click(function(a){return a.preventDefault(),ProOPC.submitOrder(this)}).data("proopcReady",!0),b&&a(this).removeAttr("disabled")):a(this).click(function(a){return a.preventDefault(),ProOPC.loginAjax(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).click(function(a){return a.preventDefault(),ProOPC.registerCheckout(this)}).data("proopcReady",!0).removeAttr("disabled"):a(this).click(function(a){return a.preventDefault(),ProOPC.guestcheckout(this)}).data("proopcReady",!0).removeAttr("disabled")});var h,i,d=a("form#EditBTAddres"),e=a("form#EditSTAddres"),f=a("form#proopc-shipment-form"),g=a("form#proopc-payment-form");a("select#virtuemart_state_id",d).attr("id","virtuemart_state_id_field"),a("select#shipto_virtuemart_state_id",e).attr("id","shipto_virtuemart_state_id_field"),a("#city_field, #zip_field, #virtuemart_country_id_field, #virtuemart_state_id_field",d).each(function(){a(this).data("proopcReady")||a(this).change(function(){ProOPC.updateBTaddress(this)}).data("proopcReady",!0),h=a(this).attr("onchange"),h&&h.indexOf("ProOPC")>=0&&a(this).removeAttr("onchange")}),a("#shipto_city_field, #shipto_zip_field, #shipto_virtuemart_country_id_field, #shipto_virtuemart_state_id_field",e).each(function(){a(this).data("proopcReady")||a(this).change(function(){ProOPC.updateSTaddress(this)}).data("proopcReady",!0),h=a(this).attr("onchange"),h&&h.indexOf("ProOPC")>=0&&a(this).removeAttr("onchange")}),a("select#virtuemart_state_id_field, select#shipto_virtuemart_state_id_field").each(function(){(a(this).hasClass("required")||a(this).attr("required"))&&a(this).data("frequired")!==!1?a(this).data("frequired",!0):a(this).data("frequired")!==!0&&a(this).data("frequired",!1)}),a("select#proopc-select-st",e).each(function(){a(this).data("proopcReady")||a(this).change(function(){ProOPC.selectSTAddress(this)}).data("proopcReady",!0),h=a(this).attr("onchange"),h&&h.indexOf("ProOPC")>=0&&a(this).removeAttr("onchange")}),a('input[name="virtuemart_shipmentmethod_id"][type="radio"]',f).each(function(){a(this).data("proopcReady")||a(this).click(function(){return ProOPC.setshipment(this)}).data("proopcReady",!0),i=a(this).attr("onclick"),i&&i.indexOf("ProOPC")>=0&&a(this).removeAttr("onclick")}),a('input[name="virtuemart_paymentmethod_id"][type="radio"]',g).each(function(){a(this).data("proopcReady")||a(this).click(function(){return ProOPC.setpayment(this)}).data("proopcReady",!0),i=a(this).attr("onclick"),i&&i.indexOf("ProOPC")>=0&&a(this).removeAttr("onclick")}),a("select",f).each(function(){var b=a(this).closest("fieldset");b.length&&a(this).width(b.width()),a(this).data("proopcReady")||a(this).change(function(){var b=a("form#proopc-shipment-form").find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked');b.length&&ProOPC.setshipment(b)}).data("proopcReady",!0)}),a("select",g).each(function(){a(this).data("proopcReady")||a(this).change(function(){var b=a("form#proopc-payment-form").find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),c=b.data("pmtype"),d=["sisowideal","buckaroo","piraeus"];b.length&&c&&a.inArray(c,d)>=0&&ProOPC.setpayment(b)}).data("proopcReady",!0)});var j=a('input[name="proopc-method"][type="radio"]');j.length&&!j.data("proopcReady")&&j.change(function(){ProOPC.opcmethod()}).removeAttr("onchange").data("proopcReady",!0);var k=VPOPC._("BT_UPDATE_FIELDS"),l=VPOPC._("ST_UPDATE_FIELDS");k&&"array"===a.type(k)&&a.each(k,function(b,c){if(c){var e=a('[name="'+c+'"]',d);e.length&&!e.data("proopcReady")&&e.change(function(){ProOPC.updateBTaddress(this)}).data("proopcReady",!0)}}),l&&"array"===a.type(l)&&a.each(l,function(b,c){if(c){var d=a('[name="'+c+'"]',e);d.length&&!d.data("proopcReady")&&d.change(function(){ProOPC.updateSTaddress(this)}).data("proopcReady",!0)}}),a("input.datepicker-db:hidden").each(function(){if(!a(this).data("proopcDateReady")){var b=this,c=a(b).data("dateInterval");c&&clearInterval(c),c=setInterval(function(){a(b).val()!=a(b).data("oldValue")&&a(b).data("oldValue",a(b).val()).trigger("change")},200),a(b).data("dateInterval",c).data("proopcDateReady",!0)}})},ProOPC.initSpinner=function(){var a={lines:13,length:3,width:2,radius:5,corners:1,rotate:0,direction:1,color:"#FFF",speed:1.5,trail:60,shadow:!1,hwaccel:!1,className:"proopc-spinner",zIndex:2e9,top:"auto",left:"auto"};ProOPC.cache.spinner=ProOPC.cache.spinner||new VPSpinner(a).spin();var b={lines:10,length:10,width:4,radius:15,corners:1,rotate:0,direction:1,color:VPOPC._("SPINNER_COLOR"),speed:1.5,trail:60,shadow:!1,hwaccel:!0,className:"proopc-page-loader",zIndex:2e9,top:20,left:14};ProOPC.cache.loader=ProOPC.cache.loader||new VPSpinner(b).spin();var c={lines:10,length:5,width:3,radius:8,corners:1,rotate:0,direction:1,color:VPOPC._("SPINNER_COLOR"),speed:1.5,trail:40,shadow:!1,hwaccel:!0,className:"proopc-area-loader",zIndex:2e9,top:20,left:14};ProOPC.cache.area_loader=ProOPC.cache.area_loader||new VPSpinner(c).spin()},ProOPC.ajaxManager=function(){var b=[],c=!1,d=!1;return{tid:null,opt:{type:"POST",dataType:"JSON",url:null,cache:!1},setContinuous:function(a){c=!!a},isRunning:function(){return d},addReq:function(a,c){a.opcTask=c?c:null,b.push(a)},removeReq:function(c){a.inArray(c,b)>-1&&b.splice(a.inArray(c,b),1)},run:function(){var g,h,i,e=this,f=c?500:1e3;d=!0,b.length?(g=b[0].hasOwnProperty("complete")?b[0].complete:null,h=b[0].hasOwnProperty("error")?b[0].error:null,i=b[0].hasOwnProperty("opcTask")&&"undefined"!=typeof b[0].opcTask&&b[0].opcTask?"ajaxManager task "+b[0].opcTask+".":"ajaxManager.",b[0].url=b[0].hasOwnProperty("url")?b[0].url:VPOPC._("URI"),b[0]=a.extend(!0,{},e.opt,b[0]),b[0].complete=function(a,c){"function"==typeof g&&g.call(this,a,c),b.shift(),e.run.apply(e,[])},b[0].error=function(a,b,c){"function"==typeof h&&h.call(this,a,b,c),console.warn("Ajax error is generated running "+i),b&&"abort"!=b&&c&&"abort"!=c&&(console.log(a),"parsererror"==b&&a.responseText&&console.log(a.responseText),console.log(b),console.log(c))},a.ajax(b[0])):e.tid=setTimeout(function(){e.run.apply(e,[])},f)},stop:function(){b=[],this.tid&&clearTimeout(this.tid),d=!1}}}(),ProOPC.opcmethod=function(){var b=a('input[type="radio"][name="proopc-method"]:checked').val();"guest"==b?(a(".proopc-reg-form, .proopc-login-form").addClass("soft-hide").css("opacity",0),a(".proopc-reg-advantages, .proopc-guest-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){a(".proopc-reg-advantages, .proopc-guest-form").animate({opacity:1},500),ProOPC.inputwidth(),ProOPC.selectwidth()},50)):"login"==b?(a(".proopc-reg-form, .proopc-reg-advantages, .proopc-guest-form").addClass("soft-hide").css("opacity",0),a(".proopc-login-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){a(".proopc-login-form").animate({opacity:1},500),ProOPC.inputwidth(),ProOPC.selectwidth()},50)):(a(".proopc-reg-advantages, .proopc-guest-form, .proopc-login-form").addClass("soft-hide").css("opacity",0),a(".proopc-reg-form").removeClass("soft-hide").css("opacity",0),setTimeout(function(){a(".proopc-reg-form").animate({opacity:1},500,function(){a("#UserRegistration #dynamic_recaptcha_1").length&&ProOPC.setStyle()}),ProOPC.inputwidth(),ProOPC.selectwidth()},50))},ProOPC._updateFieldState=function(b,c,d){var e=a(this).siblings(".status");b?(a(this).removeClass("invalid").addClass("valid").removeClass("hasFieldTip").removeAttr("title"),e.removeClass("invalid").removeClass("validating"),ProOPC.hasValue(c)&&e.addClass("valid")):null===b?(a(this).removeClass("valid").removeClass("invalid"),e.removeClass("invalid").removeClass("valid").addClass("validating")):(a(this).removeClass("valid").addClass("invalid"),e.addClass("invalid").removeClass("valid").removeClass("validating")),ProOPC.hasValue(d)?e.attr("title",VPOPC.JText._(d)):e.removeAttr("title"),ProOPC.tooltip()},ProOPC.hasValue=function(a){return!("undefined"==typeof a||!a||"0"==a)&&a},ProOPC._checkAjaxPool=function(a){ProOPC.hasValue(a)&&ProOPC.ajaxPool.hasOwnProperty(a)&&4!=ProOPC.ajaxPool[a].readystate&&ProOPC.ajaxPool[a].abort()},ProOPC._triggerEvent=function(b){b=ProOPC.hasValue(b)&&"string"===a.type(b)?[b]:b,a(c).trigger("vpopc.event",b)},ProOPC._reload=function(){var b=a("form#proopc-reload-form");b.length?b.submit():ProOPC._reload()},ProOPC.ajax=function(b,c){b=ProOPC.hasValue(b)?b:"dummy";var d={type:"POST",dataType:"JSON",url:VPOPC._("URI"),data:"ctask="+b,cache:!1,async:!0,error:function(d,e,f){"abort"!=e&&"abort"!=f&&(console.warn("Ajax error is generated executing ctask "+b+"."),"parsererror"==e&&d.responseText&&console.log(d.responseText),console.log(d),console.log(e),console.log(f)),"undefined"!=typeof c.errorCallback&&"function"==a.type(c.errorCallback)&&c.errorCallback.call(this)}};return c=a.extend(!0,{},d,c),ProOPC._checkAjaxPool(b),ProOPC.ajaxPool[b]=a.ajax(c),ProOPC.ajaxPool[b]},ProOPC.bindFormValidator=function(){var b=a("form#UserLogin"),c=a("form#GuestUser"),d=a("form#UserRegistration"),e="change blur keyup";a('input[type="text"]:not(#proopc-secretkey), input[type="password"], input[type="email"]',b).on(e,function(b){a(this).val()?ProOPC._updateFieldState.call(this,!0,!1):ProOPC._updateFieldState.call(this,!1,!1,"PLG_VPONEPAGECHECKOUT_REQUIRED_FIELD")}),a('input[type="text"], input[type="email"]',c).on(e,function(b){if("email_field"!=a(this).attr("id"))return!1;var c=a(this).val();c&&c.length&&(c=a.trim(c),a(this).val(c)),ProOPC.validateEmail(c)?ProOPC._updateFieldState.call(this,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):ProOPC._updateFieldState.call(this,!1,!0,"PLG_VPONEPAGECHECKOUT_EMAIL_INVALID")}),a('input[type="text"], input[type="email"], input[type="password"], input[type="checkbox"], select, textarea',d).on(e,function(b){var c=this,d=a(this).closest("form"),e=a(this).parent(".proopc-input"),f=a(c).attr("required"),g=a(c).attr("id"),h=a(c).val();if(!a(c).hasClass("required")&&!ProOPC.hasValue(f)&&!e.data("required"))return!0;switch(a(c).attr("required",!0),g){case"email_field":h&&h.length&&(h=a.trim(h),a(c).val(h)),ProOPC.validateEmail.call(c,h)?(d.find("input#verify_email_field").trigger("change"),VPOPC._("AJAXVALIDATION")?("undefined"!=typeof ProOPC.cache.emails&&"object"===a.type(ProOPC.cache.emails)||(ProOPC.cache.emails={}),ProOPC.cache.emails.hasOwnProperty(h)?ProOPC.cache.emails[h]?(ProOPC.removeFieldTip(c,!1),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(c).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),ProOPC.fieldTip(),ProOPC.showFieldTip(c)):ProOPC.ajax("checkemail",{beforeSend:function(a){ProOPC._updateFieldState.call(c,null,!1,null)},data:"ctask=checkemail&email="+h,success:function(b){"undefined"==typeof b.valid||b.valid?(ProOPC.removeFieldTip(c,!1),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),ProOPC.cache.emails[h]=!0):(ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(c).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_PROFILE_EMAIL1_MESSAGE")),ProOPC.fieldTip(),ProOPC.showFieldTip(c),ProOPC.cache.emails[h]=!1)}})):ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_EMAIL_INVALID");break;case"verify_email_field":h&&h.length&&(h=a.trim(h),a(c).val(h));var i=d.find("input#email_field").val();h==i&&h?ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");break;case"username_field":ProOPC.validateUsername.call(c,h)?VPOPC._("AJAXVALIDATION")?("undefined"!=typeof ProOPC.cache.usernames&&"object"===a.type(ProOPC.cache.usernames)||(ProOPC.cache.usernames={}),ProOPC.cache.usernames.hasOwnProperty(h)?ProOPC.cache.usernames[h]?(ProOPC.removeFieldTip(c,!1),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(c).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),ProOPC.fieldTip(),ProOPC.showFieldTip(c)):ProOPC.ajax("checkusername",{beforeSend:function(a){ProOPC._updateFieldState.call(c,null,!1,null)},data:"ctask=checkuser&username="+h,success:function(b){"undefined"==typeof b.valid||b.valid?(ProOPC.removeFieldTip(c,!1),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),ProOPC.cache.usernames[h]=!0):(ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),a(c).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_PROFILE_USERNAME_MESSAGE")),ProOPC.fieldTip(),ProOPC.showFieldTip(c),ProOPC.cache.usernames[h]=!1)}})):ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_USERNAME_INVALID");break;case"password_field":var j=d.find("input#password2_field"),k=d.find("#password-stregth");d.find("#meter-status");j.removeClass("valid").siblings(".status").removeClass("valid"),ProOPC.removeFieldTip(c,!1),h&&ProOPC.validatePassword.call(c,h)?(ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"),ProOPC.checkStrength.call(c,h)):(a("#password-stregth, #meter-status",d).removeAttr("class").addClass("invalid"),ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),k.text(""));break;case"password2_field":var i=d.find("input#password_field").val();h==i&&h?ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID");break;case"name_field":default:h?ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"):ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID")}})},ProOPC.validateForm=function(){return a(this).find("input, select, textarea").trigger("blur"),!a(this).find(".invalid").length||(ProOPC.setmsg(1,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_REQUIRED_FIELDS_MISSING")),!1)},ProOPC.validateEmail=function(a){if(VPOPC._("DISABLELIVEVALIDATION"))return!0;var b=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return!(!b.test(a)||a.length<5)},ProOPC.validateUsername=function(a){if(VPOPC._("DISABLELIVEVALIDATION"))return!0;var b=/^[a-zA-Z0-9]+$/;return!!b.test(a)},ProOPC.validatePassword=function(b){if(VPOPC._("DISABLELIVEVALIDATION"))return!0;var c=this,d=!1;if(ProOPC.removeFieldTip(c,!1),a(this).removeAttr("title").removeClass("hasFieldTip"),b.indexOf(" ")>=0)a(c).addClass("hasFieldTip").attr("title",VPOPC.JText._("COM_USERS_MSG_SPACES_IN_PASSWORD")),r=!0;else if(VPOPC._("PASSWORD_INTEGERS")||VPOPC._("PASSWORD_SYMBOLS")||VPOPC._("PASSWORD_UPPERCASE")){var e=b.match(/\d/g),f=b.match(/\W/g),g=b.match(/[A-Z]/g);VPOPC._("PASSWORD_INTEGERS")>0&&(!e||e.length<VPOPC._("PASSWORD_INTEGERS"))?(1==VPOPC._("PASSWORD_INTEGERS")?a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N_1",VPOPC._("PASSWORD_INTEGERS"))):a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N",VPOPC._("PASSWORD_INTEGERS"))),d=!0):VPOPC._("PASSWORD_SYMBOLS")>0&&(!f||f.length<VPOPC._("PASSWORD_SYMBOLS"))?(1==VPOPC._("PASSWORD_SYMBOLS")?a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N_1",VPOPC._("PASSWORD_SYMBOLS"))):a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N",VPOPC._("PASSWORD_SYMBOLS"))),d=!0):VPOPC._("PASSWORD_UPPERCASE")>0&&(!g||g.length<VPOPC._("PASSWORD_UPPERCASE"))&&(1==VPOPC.optioe.PASSWORD_UPPERCASE?a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N_1",VPOPC._("PASSWORD_UPPERCASE"))):a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N",VPOPC._("PASSWORD_UPPERCASE"))),d=!0)}else VPOPC._("PASSWORD_LENGTH")>0&&b.length<VPOPC._("PASSWORD_LENGTH")&&(a(c).addClass("hasFieldTip").attr("title",VPOPC.JText.sprintf("COM_USERS_MSG_PASSWORD_TOO_SHORT_N",VPOPC._("PASSWORD_LENGTH"))),d=!0);return!d||(ProOPC.fieldTip(),ProOPC.showFieldTip(this),!1)},ProOPC.checkStrength=function(b){if(VPOPC._("DISABLELIVEVALIDATION"))return!0;var c=this,d=a(c).closest("form"),e=a("#password-stregth, #meter-status",d),f=d.find("#password-stregth"),h=(d.find("#meter-status"),0);return b.length<4?(e.removeAttr("class").addClass("short"),f.text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_TOO_SHORT")),ProOPC._updateFieldState.call(c,!1,!0,"PLG_VPONEPAGECHECKOUT_INVALID"),!1):(b.length>4&&(h+=1),b.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(h+=1),b.match(/([a-zA-Z])/)&&b.match(/([0-9])/)&&(h+=1),b.match(/([!,%,&,@,#,$,^,*,?,_,~])/)&&(h+=1),b.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,",%,&,@,#,$,^,*,?,_,~])/)&&(h+=1),void(h<2?(e.removeAttr("class").addClass("weak"),f.text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_WEAK")),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):2==h?(e.removeAttr("class").addClass("good"),f.text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_GOOD")),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED")):(e.removeAttr("class").addClass("strong"),f.text(VPOPC.JText._("PLG_VPONEPAGECHECKOUT_STRONG")),ProOPC._updateFieldState.call(c,!0,!0,"PLG_VPONEPAGECHECKOUT_VALIDATED"))))},ProOPC.guestcheckout=function(){var b=a("form#GuestUser"),c=a("button#proopc-task-guestcheckout",b),d=a("#proopc-guest-process",b);return ProOPC.ajax("guestcheckout",{dataType:"HTML",data:b.serialize(),beforeSend:function(){return!!ProOPC.validateForm.call(b)&&(d.append(ProOPC.cache.spinner.el),void c.attr("disabled",!0))},success:function(a){d.find(".proopc-spinner").remove(),c.removeAttr("disabled"),ProOPC.setmsg("info",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_EMAIL_SAVED"),!1),ProOPC.processCheckout({error:0}),ProOPC._triggerEvent(["guestcheckout.initiated"])},errorCallback:function(){d.find(".proopc-spinner").remove(),c.removeAttr("disabled"),ProOPC.setmsg("1","Some error occurred. Check console log for more details.")}}),!1},ProOPC.registerCheckout=function(){var b=a("form#UserRegistration"),c=a("button#proopc-task-registercheckout",b),d=a("#proopc-register-process",b);return ProOPC.ajax("register",{data:b.serialize()+"&ctask=register",beforeSend:function(){return!!ProOPC.validateForm.call(b)&&(c.attr("disabled",!0),void d.append(ProOPC.cache.spinner.el))},success:function(b){if(c.removeAttr("disabled"),d.find(".proopc-spinner").remove(),"object"==a.type(b)&&b.msg)if(1==b.error){if(ProOPC.setmsg("1",b.msg),b.reload)return ProOPC._reload(),!1;"undefined"!=typeof Recaptcha&&Recaptcha.reload(),ProOPC._triggerEvent(["registration.failed"])}else ProOPC.setmsg(3,b.msg),ProOPC._triggerEvent(["registration.success"]),ProOPC._onRegistrationSuccess(),b.stop||(VPOPC._("RELOAD")?ProOPC._reload():setTimeout(function(){ProOPC.processCheckout(b)},100));else ProOPC._triggerEvent(["registration.success"]),ProOPC._onRegistrationSuccess(),"1"==b||1==b?(ProOPC.setmsg(3,VPOPC.JText._("COM_VIRTUEMART_REG_COMPLETE")),VPOPC._("RELOAD")?ProOPC._reload():setTimeout(function(){ProOPC.processCheckout(b)},100)):"string"===a.type(b)&&b.indexOf("</head>")==-1?ProOPC.setmsg(3,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_REGISTRATION_NEED_LOGIN")):(ProOPC.setmsg(3,VPOPC.JText._("COM_VIRTUEMART_REG_COMPLETE")),VPOPC._("RELOAD")?ProOPC._reload():setTimeout(function(){ProOPC.processCheckout({error:0})},100))},errorCallback:function(){c.removeAttr("disabled"),d.find(".proopc-spinner").remove(),ProOPC.setmsg(1,"Error submiting registration form. Check console log for more details.")}}),!1},ProOPC._onRegistrationSuccess=function(){var b=a("form#UserRegistration"),c=a('input[name="proopc-method"][value="login"]'),d=a("#password-stregth",b),e=a("#meter-status",b);b[0].reset(),b.find("i.status").removeClass("valid").removeClass("invalid"),d.removeAttr("class").text(""),e.removeAttr("class"),c.length&&c.prop("checked",!0).trigger("change")},ProOPC.disableSubmit=function(){a("button#proopc-order-submit").attr("disabled","disabled").trigger("disabled")},ProOPC.enableSubmit=function(){var b=a("button#proopc-order-submit");ProOPC.cache.submitTimeout&&b.attr("disabled")&&clearTimeout(ProOPC.cache.submitTimeout),ProOPC.cache.submitTimeout=setTimeout(function(){b.removeAttr("disabled").trigger("enabled")},1e3)},ProOPC.disableMethodSelection=function(){a('input[name="virtuemart_paymentmethod_id"][type="radio"], input[name="virtuemart_shipmentmethod_id"][type="radio"]').attr("disabled","disabled")},ProOPC.enableMethodSelection=function(){a('input[name="virtuemart_paymentmethod_id"][type="radio"], input[name="virtuemart_shipmentmethod_id"][type="radio"]').removeAttr("disabled")},ProOPC.addloader=function(b){var c='<div class="proopc-loader-overlay"></div><div class="proopc-area-loader"><span></span></div>';a(b).each(function(){a(this).find(".proopc-loader-overlay").length||(a(this).append(c),a(".proopc-area-loader > span").html(ProOPC.cache.area_loader.el))}),ProOPC.disableSubmit(),a("body").addClass("proopc-loading")},ProOPC.removeloader=function(b){a(b).each(function(){a(".proopc-loader-overlay, .proopc-area-loader",this).remove()}),ProOPC.enableSubmit(),a("body").removeClass("proopc-loading")},ProOPC.addPageLoader=function(b){if(!a("#proopc-page-overlay",c).length){var d=a("<div />",{id:"proopc-page-overlay"}),e=a("<span />").append(ProOPC.cache.loader.el),f=a("<div />",{id:"proopc-page-spinner"}).append(e);a("body").append(d).append(f),a("#proopc-page-overlay").css({display:"block",height:a("body").outerHeight()}).animate({opacity:.7},300)}if(ProOPC.hasValue(b)){var g=a("#proopc-order-process");b=VPOPC.JText._(b,b),b&&(g.length||(g=a("<div />",{id:"proopc-order-process"}).appendTo("body")),g.text(b))}a("body").addClass("proopc-page-loading")},ProOPC.removePageLoader=function(){a("#proopc-page-overlay, #proopc-page-spinner, #proopc-order-process",c).remove(),a("body").removeClass("proopc-page-loading")},ProOPC.getToken=function(){return a("#formToken input:hidden").attr("name")+"=1"},ProOPC.pluginLoaded=function(b){return!!a.hasOwnProperty(b)||!!a.fn.hasOwnProperty(b)},ProOPC.setmsg=function(b,c,d){d="undefined"==typeof d||void 0===typeof d||d;var e=a("<button />",{type:"button",class:"close"}).attr("onclick","ProOPC.close(this);").html("&times;"),f=a("<span />").html(c),g=a("<div />",{class:"proopc-alert"}).append(e).append(f),h="proopc-warning-msg";"1"==b||"error"==b?h="proopc-error-msg":"2"==b||"warning"==b?h="proopc-warning-msg":"3"==b||"success"==b?h="proopc-success-msg":"4"!=b&&"info"!=b||(h="proopc-info-msg"),g.addClass(h),a("#proopc-system-message").html(g),d&&a("html,body").animate({scrollTop:a("#proopc-system-message").offset().top-100},500)},ProOPC.initStateField=function(){if(!ProOPC.pluginLoaded("vm2front"))return console.warn('jQuery.vm2front plugin not loaded. Please enable "Using the Script ajax Countries / Regions" option in VirtueMart Configuration.'),!1;var b=a("input#BTStateID").val(),c=a("input#STStateID").val(),d={dest:"#virtuemart_state_id_field",ids:b,prefiks:""};a("select#virtuemart_state_id_field").length&&a("select#virtuemart_country_id_field").vm2front("list",d),d.ids=c,d.prefiks="shipto_",a("select#shipto_virtuemart_state_id_field").length&&(d.dest="#shipto_virtuemart_state_id_field",a("select#shipto_virtuemart_country_id_field").vm2front("list",d))},ProOPC.processCheckout=function(b){if(ProOPC.hasValue(b)&&"object"===a.type(b)||(b={error:0,msg:[]}),b.error&&b.msg.length){var c="";return a.each(b.msg,function(a,b){c=c+'<div class="error-msg">'+b+"</div>"}),ProOPC.setmsg(1,c),!1}ProOPC.ajax("procheckout",{dataType:"HTML",data:"task=procheckout",beforeSend:function(){ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_PLEASE_WAIT"),a(".proopc-tooltip, .proopc-fieldtip").remove()},success:function(b){var c=a(b).find("div#ProOPC").html();c||(c=b),a("div#ProOPC").html(c),VPOPC._("RELOAD")||a("html, body").animate({scrollTop:a("#proopc-system-message").offset().top-100},500),ProOPC._triggerEvent(["checkout.finalstage"])},complete:function(){ProOPC.initStateField(),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.bindFormValidator(),ProOPC.productdetails(),ProOPC.enableSubmit(),ProOPC.defaultSP(),ProOPC.removePageLoader(),"undefined"==typeof klarna&&"undefined"==typeof klarna||ProOPC.loadPaymentScripts(),ProOPC.loadShipmentScripts()}})},ProOPC.loginAjax=function(){var b=a("form#UserLogin"),c=a("button#proopc-task-loginajax",b),d=b.find('input[name="ctask"]:hidden'),e=b.find("#proopc-login-process");return!!ProOPC.validateForm.call(b)&&("login"!=d.val()&&d.val("login"),ProOPC.ajax("login",{data:b.serialize(),beforeSend:function(){e.append(ProOPC.cache.spinner.el),c.attr("disabled",!0)},success:function(a){e.find(".proopc-spinner").remove(),c.removeAttr("disabled");var b=!0;"1"==a||1==a?b=!0:a&&a.indexOf("</head>")!=-1||(b=!1),b?(ProOPC.setmsg("success",VPOPC.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_COMPLETED")),ProOPC._triggerEvent(["login.success"]),VPOPC._("RELOAD")?ProOPC._reload():ProOPC.processCheckout()):(ProOPC.setmsg("warning",VPOPC.JText._("JLIB_LOGIN_AUTHENTICATE")),ProOPC._triggerEvent(["login.failed"]))},errorCallback:function(){e.find(".proopc-spinner").remove(),c.removeAttr("disabled"),ProOPC.setmsg(1,"A system error occurred during login. See console log for more details.")}}),!1)},ProOPC.updateBTaddress=function(b){ProOPC.ajaxManager.addReq({data:a("form#EditBTAddres").serialize()+"&ctask=savebtaddress&"+ProOPC.getToken(),beforeSend:function(){ProOPC.disableSubmit()},success:function(a){ProOPC._triggerEvent(["checkout.bt.updated"]),ProOPC.getshipmentpaymentcartlist()}},"updateBTaddress")},ProOPC.updateSTaddress=function(b){ProOPC.ajaxManager.addReq({data:a("form#EditSTAddres").serialize()+"&ctask=savestaddress&"+ProOPC.getToken(),beforeSend:function(){ProOPC.disableSubmit()},success:function(b){ProOPC._triggerEvent(["checkout.st.updated"]),ProOPC.getshipmentpaymentcartlist(),"undefined"!=typeof b.userinfo_id&&a("input#shipto_virtuemart_userinfo_id").val(b.userinfo_id)}},"updateSTaddress")},ProOPC.selectSTAddress=function(b){ProOPC.ajax("selectstaddress",{data:"ctask=selectstaddress&shipto_virtuemart_userinfo_id="+a(b).val(),beforeSend:function(){ProOPC.addloader("#proopc-st-address"),ProOPC.disableSubmit()},success:function(b){"object"!==a.type(b)&&(console.warn("Invalid data received"),console.log(b)),a("#proopc-st-address").html(b.editst),ProOPC.pluginLoaded("vm2front")?(b.stateid>0?a("input#STStateID").val(b.stateid):a("input#STStateID").val(""),a("#shipto_virtuemart_country_id_field").vm2front("list",{dest:"#shipto_virtuemart_state_id_field",ids:'"'+b.stateid+'"',prefiks:"shipto_"})):console.warn('jQuery.vm2front plugin not loaded. Please enable "Using the Script ajax Countries / Regions" option in VirtueMart Configuration.'),ProOPC.setStyle(),a("#shipto_virtuemart_state_id_field").trigger("liszt:updated"),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.removeloader("#proopc-st-address"),ProOPC._triggerEvent(["checkout.st.selected"]),ProOPC.getshipmentpaymentcartlist()}})},ProOPC.setst=function(b){b&&a(b).length&&(ProOPC.disableSubmit(),b.checked?ProOPC.ajax("btasst",{data:"ctask=btasst",beforeSend:function(){a(".proopc-st-address .edit-address").slideUp()},success:function(){ProOPC._triggerEvent(["checkout.btasst"]),ProOPC.getshipmentpaymentcartlist()}}):ProOPC.ajax("btasst",{data:"ctask=btnotasst",beforeSend:function(){a(".proopc-st-address .edit-address").slideDown(),ProOPC.inputwidth(),ProOPC.selectwidth()},success:function(){ProOPC._triggerEvent(["checkout.btnotasst"]);var b=a("select#proopc-select-st");b.length&&b.val()>0?ProOPC.selectSTAddress(b[0]):ProOPC.updateSTaddress()}}))},ProOPC.getshipmentpaymentcartlist=function(b){b||a("#proopc-system-message").html(""),ProOPC.ajax("getshipmentpaymentcartlist",{beforeSend:function(){ProOPC.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.disableSubmit()},success:function(b){if("object"!==a.type(b))return ProOPC._reload(),!1;if(0==b.pqty)return ProOPC._reload(),!1;if(b.msg&&ProOPC.setmsg(b.msg_type,b.msg),a("#proopc-shipments").html(b.shipments),a("#proopc-payments").html(b.payments),a("#proopc-pricelist").html(b.cartlist),a("#proopc-cart-totalqty").text(b.pqty),b.payment_scripts.length>0&&""!==b.payment_scripts[0])var c=b.payment_scripts;""!==b.payment_script[0]&&a.each(b.payment_script,function(b,d){a.getScript(d,function(b,d,e){"undefined"!=typeof c&&a.each(c,function(a,b){})})}),b.shipment_scripts.length>0&&""!==b.shipment_scripts[0]&&a.each(b.shipment_scripts,function(b,c){a("head").append('<script type="text/javascript">'+c+"</script>")}),ProOPC._triggerEvent(["checkout.updated.shipmentpaymentcartlist"]),ProOPC.productdetails(),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.enableSubmit(),ProOPC.defaultSP()},errorCallback:function(){ProOPC.removeloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.enableSubmit()}})},ProOPC.getcartlist=function(c,d){d||a("#proopc-system-message").html(""),ProOPC.ajax("getcartlist",{beforeSend:function(){ProOPC.addloader("#proopc-pricelist"),ProOPC.disableSubmit()},success:function(d){return"object"!==a.type(d)?(ProOPC._reload(),!1):0==d.pqty?(ProOPC._reload(),!1):(d.msg&&ProOPC.setmsg(d.msg_type,d.msg),a("#proopc-pricelist").html(d.cartlist),
a("#proopc-cart-totalqty").text(d.pqty),ProOPC.hasValue(d.selected_shipment)||a('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop("checked",!1),ProOPC.hasValue(d.selected_payment)||a('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop("checked",!1),ProOPC._triggerEvent(["checkout.updated.cartlist"]),ProOPC.productdetails(),ProOPC.setStyle(),ProOPC.removeloader("#proopc-pricelist"),ProOPC.enableSubmit(),void("undefined"!=typeof c&&c&&(b.location=c)))},errorCallback:function(){ProOPC.removeloader("#proopc-pricelist"),ProOPC.enableSubmit()}})},ProOPC.getcartsummery=function(){ProOPC.ajax("getcartsummery",{beforeSend:function(){ProOPC.addloader("#proopc-pricelist"),ProOPC.disableSubmit()},success:function(b){return"object"!==a.type(b)?(ProOPC._reload(),!1):0==b.pqty?(ProOPC._reload(),!1):(b.msg&&ProOPC.setmsg(b.msg_type,b.msg),a("#proopc-cart-totalqty").text(b.pqty),a("#proopc-pricelist").html(b.cartsummery),ProOPC._triggerEvent(["checkout.updated.cartlist"]),ProOPC.setStyle(),ProOPC.removeloader("#proopc-pricelist"),void ProOPC.enableSubmit())},errorCallback:function(){ProOPC.removeloader("#proopc-pricelist"),ProOPC.enableSubmit()}})},ProOPC.getpayments=function(){ProOPC.ajax("getpaymentlist",{beforeSend:function(){ProOPC.addloader("#proopc-payments"),ProOPC.disableSubmit()},success:function(b){if("object"!==a.type(b))return ProOPC._reload(),!1;if(a("#proopc-payments").html(b.payments),b.payment_scripts.length>0&&""!==b.payment_scripts[0])var c=b.payment_scripts;""!==b.payment_script[0]&&a.each(b.payment_script,function(b,d){a.getScript(d,function(b,d,e){"undefined"!=typeof c&&a.each(c,function(a,b){})})}),ProOPC._triggerEvent(["checkout.updated.paymentlist"]),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-payments"),ProOPC.enableSubmit(),ProOPC.defaultSP()},errorCallback:function(){ProOPC.removeloader("#proopc-payments"),ProOPC.enableSubmit()}})},ProOPC.getPaymentData=function(b){b=ProOPC.hasValue(b),a(".klarna_box_bottom").hide(),a(".vmpayment_cardinfo").removeClass("show").addClass("hide");var c=a("form#proopc-payment-form"),d=c.find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');if(!d.length)return!1;var e=d.data("pmtype"),f=d.data("paypalproduct"),g="0",h="0";return f&&(e+=f),e&&a(".vmpayment_cardinfo."+e).length&&(a(".vmpayment_cardinfo."+e).removeClass("hide").addClass("show"),h="1"),"sisowideal"==e&&(h="1"),b&&(g="1",h="1"),d.hasClass("klarnaPayment")&&ProOPC.klarnaOpenClose.call(d[0]),ProOPC._triggerEvent(["prepare.data.payment",d[0]]),c.serialize()+"&ajax=1&savecc="+g+"&payment_data="+h},ProOPC.getShipmentData=function(){var b=a("form#proopc-shipment-form"),c=b.find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked');if(!c.length)return!1;var d=c.val(),e=c.data("usps"),f=c.data("ups");return a("#usps_name-"+d,b).length&&e&&a("#usps_name-"+d,b).val(e.service),a("#usps_rate-"+d,b).length&&e&&a("#usps_rate-"+d,b).val(e.rate),a("#ups_rate-"+d,b).length&&f&&a("#ups_rate-"+d,b).val(f.id),ProOPC._triggerEvent(["prepare.data.shipment",c[0]]),b.serialize()},ProOPC.loadPaymentScripts=function(){ProOPC.ajax("getpaymentscripts",{beforeSend:function(){ProOPC.addloader("#proopc-payments"),ProOPC.disableSubmit()},success:function(b){"object"===a.type(b)&&(a("#proopc-payments").html(b.payments),b.payment_scripts.length&&""!==b.payment_scripts[0]&&(payment_scripts=b.payment_scripts),b.payment_script.length&&""!==b.payment_script[0]&&a.each(b.payment_script,function(b,c){a.getScript(c,function(b,c,d){"undefined"!=typeof payment_scripts&&a.each(payment_scripts,function(a,b){})})})),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-payments"),ProOPC.defaultSP(),ProOPC.enableSubmit()},errorCallback:function(){ProOPC.removeloader("#proopc-payments"),ProOPC.enableSubmit()}})},ProOPC.loadShipmentScripts=function(){return!!a("form#proopc-shipment-form select").length&&void ProOPC.ajax("getshipmentscripts",{beforeSend:function(){ProOPC.addloader("#proopc-shipments"),ProOPC.disableSubmit()},success:function(b){"object"===a.type(b)&&(a("#proopc-shipments").html(b.shipments),b.shipment_scripts.length&&b.shipment_scripts[0]&&a.each(b.shipment_scripts,function(b,c){a("head, body").find('script[type="text/javascript"]').each(function(){var b=a(this).attr("src");if("undefined"==typeof b||b===!1)return a(this).append(c),!1})})),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader("#proopc-shipments"),ProOPC.defaultSP(),ProOPC.enableSubmit()},errorCallback:function(){ProOPC.removeloader("#proopc-shipments"),ProOPC.enableSubmit()}})},ProOPC.defaultSP=function(){var d,b=a("form#proopc-shipment-form"),c=a("form#proopc-payment-form"),e='input[type="radio"][name="virtuemart_shipmentmethod_id"]',f='input[type="radio"][name="virtuemart_paymentmethod_id"]',g=VPOPC._("AUTOSHIPMENT"),h=VPOPC._("AUTOPAYMENT"),i="";g>=0&&!b.find(e+":checked").length&&b.find(e).length&&(0==g&&(g=b.find(e+":first").val()),d=b.find(e+'[value="'+g+'"]'),g>0&&d.length&&(d.attr("checked",!0),i+=ProOPC.getShipmentData())),h>=0&&!c.find(f+":checked").length&&c.find(f).length&&(0==h&&(h=c.find(f+":first").val()),d=c.find(f+'[value="'+h+'"]'),h>0&&d.length&&"exp"!=d.data("paypalproduct")&&(d.attr("checked",!0),i&&(i+="&"),i+=ProOPC.getPaymentData())),i&&""!==i&&ProOPC.ajax("setdefaultsp",{data:"ctask=setdefaultsp&"+i,beforeSend:function(){ProOPC.addloader("#proopc-shipments, #proopc-payments"),ProOPC.disableSubmit()},success:function(b){ProOPC.hasValue(b.selected_shipment)||a('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop("checked",!1),ProOPC.hasValue(b.selected_payment)||a('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop("checked",!1),ProOPC.enableSubmit(),ProOPC.removeloader("#proopc-shipments, #proopc-payments"),"undefined"!=typeof b.error&&"undefined"!=typeof b.error&&b.error?ProOPC._triggerEvent(["checkout.defaultsp.failed"]):(ProOPC._triggerEvent(["checkout.defaultsp.success"]),ProOPC.getcartlist())},errorCallback:function(){a('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop("checked",!1),a('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop("checked",!1),ProOPC.enableSubmit(),ProOPC.removeloader("#proopc-shipments, #proopc-payments")}})},ProOPC.setshipment=function(b){var c=ProOPC.getShipmentData(),d=a("form#proopc-shipment-form"),e=d.find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked'),f=e.val();return!!c&&void ProOPC.ajax("setshipment",{data:"ctask=setshipments&"+c,beforeSend:function(){ProOPC.disableSubmit(),ProOPC.disableMethodSelection()},success:function(b){ProOPC.hasValue(b.selected)||(e.prop("checked",!1),b.selected=0),a("input#proopc-savedShipment:hidden").val(b.selected),b.error?(ProOPC.setmsg("2",b.msg),ProOPC._triggerEvent(["checkout.shipmentselection.failed",f]),ProOPC.getcartlist(!1,!0)):(ProOPC._triggerEvent(["checkout.shipmentselection.success",f]),ProOPC.getcartlist(),VPOPC._("RELOADPAYMENTS")&&ProOPC.getpayments())},errorCallback:function(){e.prop("checked",!1),ProOPC.enableSubmit()}})},ProOPC.setpayment=function(b){var c=ProOPC.hasValue(b)&&a(b).length&&a(b).hasClass("btn-additional-klarna"),d=!c,e=ProOPC.getPaymentData(c),f=a("form#proopc-payment-form"),g=f.find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),h=g.val();return!!e&&void ProOPC.ajax("setpayment",{data:"ctask=setpayment&"+e,async:d,beforeSend:function(){ProOPC.disableSubmit(),ProOPC.disableMethodSelection()},success:function(b,d,e){if(e&&e.getResponseHeader("content-type").indexOf("text/html")>=0&&"undefined"!=typeof klarna){a("#proopc-order-submit").removeAttr("disabled"),a("<div />",{id:"proopc-temp",style:"display:none"}).appendTo("body"),a("#proopc-temp").append(b);a("#proopc-temp").find("div#system-message-container").html();ProOPC.setmsg(1,r),ProOPC.enableSubmit()}if("string"!==a.type(b)&&"string"!=typeof b||(b=a.parseJSON(b)),b.redirect=b.redirect?b.redirect:0,ProOPC.hasValue(b.selected)||g.prop("checked",!1),b.error)ProOPC.setmsg(2,b.msg),ProOPC._triggerEvent(["checkout.paymentselection.failed",h]),ProOPC.getcartlist(!1,!0);else if(b.redirect)ProOPC.setmsg(4,VPOPC.JText._("VMPAYMENT_PAYPAL_REDIRECT_MESSAGE")),ProOPC._triggerEvent(["checkout.paymentselection.successs",h]),ProOPC.getcartlist(b.redirect,!0);else if(c)ProOPC._triggerEvent(["checkout.paymentmethod.additionaldata.saved",h]),ProOPC.setmsg(4,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED")),ProOPC.enableSubmit();else{var i=!1;!b.msg||!g.hasClass("klarnaPayment")&&ProOPC.hasValue(b.selected)||(ProOPC.setmsg(2,b.msg),i=!0),ProOPC._triggerEvent(["checkout.paymentselection.successs",h]),ProOPC.getcartlist(!1,i)}},errorCallback:function(){g.prop("checked",!1),ProOPC.enableSubmit()}})},ProOPC.deleteproduct=function(b){return ProOPC.ajax("deleteproduct",{data:"ctask=deleteproduct&id="+a(b).data("vpid"),beforeSend:function(){ProOPC.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.disableSubmit()},success:function(c){return ProOPC._triggerEvent(["checkout.products.deleted",a(b).data("vpid")]),a("#proopc-system-message").html(""),a(".proopc-product-hover").addClass("hide"),0!=c.pqty&&c.pqty?(a("input#proopc-cart-summery").length>0?ProOPC.getcartsummery():ProOPC.getshipmentpaymentcartlist(),void a("body").trigger("updateVirtueMartCartModule")):(ProOPC._reload(),!1)},errorCallback:function(){ProOPC.enableSubmit()}}),!1},ProOPC.updateproductqty=function(b){var c=!1;return a(".proopc-qty-input").each(function(){if(a(this).data("quantity")!=a(this).val())return c=!0,!1}),!!c&&(ProOPC.ajax("updateProductQty",{data:a("#proopc-carttable-form").serialize(),beforeSend:function(){ProOPC.addloader("#proopc-pricelist, #proopc-payments, #proopc-shipments"),ProOPC.disableSubmit()},success:function(b){return"object"!==a.type(b)?(ProOPC._reload(),!1):(b.error?ProOPC.setmsg(2,b.msg):(ProOPC._triggerEvent(["checkout.products.updated",b.pqty]),a("#proopc-system-message").html("")),a(".proopc-product-hover").addClass("hide"),0!=b.pqty&&b.pqty?(a("input#proopc-cart-summery").length>0?ProOPC.getcartsummery():ProOPC.getshipmentpaymentcartlist(),void a("body").trigger("updateVirtueMartCartModule")):(ProOPC._reload(),!1))},errorCallback:function(){ProOPC.enableSubmit()}}),!1)},ProOPC.savecoupon=function(b){var c=a("input#proopc-coupon-code"),d=c.val(),e=c.data("default");return a("#proopc-system-message").html(""),d&&d!=e?(ProOPC.ajax("setcoupon",{data:"ctask=setcoupon&coupon_code="+encodeURIComponent(d),beforeSend:function(){ProOPC.addloader("#proopc-coupon"),ProOPC.disableSubmit()},success:function(b){if("object"!==a.type(b))return ProOPC._reload(),!1;ProOPC._triggerEvent(["checkout.coupon.submitted",d,b.msg]);var f=b.error?b.error:"success";c.val(e),!b.wait&&b.msg&&ProOPC.setmsg(f,b.msg),ProOPC.removeloader("#proopc-coupon"),VPOPC._("RELOADALLFORCOUPON")?ProOPC.getshipmentpaymentcartlist(!0):ProOPC.getcartlist(null,!0),a("body").trigger("updateVirtueMartCartModule")},errorCallback:function(){ProOPC.setmsg(1,"An error has occurred while processing coupon code. See console log for more details."),ProOPC.removeloader("#proopc-coupon"),ProOPC.enableSubmit()}}),!1):(ProOPC.setmsg(2,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_COUPON_EMPTY")),!1)},ProOPC.fieldGroups=[["title","first_name"],["middle_name","last_name"],["zip","city"],["shipto_middle_name","shipto_last_name"],["shipto_zip","shipto_city"]],ProOPC.inputwidth=function(){if(a("form#EditBTAddres").children().each(function(b){a(this).data("pos",b)}),a("form#EditSTAddres").children().each(function(b){a(this).data("pos",b)}),VPOPC._("GROUPING")&&"array"===a.type(ProOPC.fieldGroups)&&ProOPC.fieldGroups.length){var b,c;a.each(ProOPC.fieldGroups,function(d,e){"array"===a.type(e)&&2==e.length&&(b=a("."+e[0]+"-group"),c=a("."+e[1]+"-group"),b.length&&c.length&&b.data("pos")+1==c.data("pos")&&a("."+e[0]+"-group, ."+e[1]+"-group").wrapAll('<div class="proopc-row group-enabled" />'))})}a('.proopc-bt-address input[type="text"], .proopc-st-address input[type="text"], .proopc-additional-info input[type="text"], .proopc-confirm-order input[type="text"]').each(function(){a(this).css("width","");var b=a(this).parent(".inner").width();a(this).width(b-15)}),a('.proopc-register-login input[type="text"], .proopc-register-login input[type="password"], .proopc-register-login input[type="email"]').each(function(){a(this).css("width","");var b=a(this).parent(".proopc-input").width();a(this).width(b-27)}),a(".proopc-register-login button").each(function(){a(this).css("width","");var b=a(this).parent(".proopc-input").outerWidth(!0);a(this).width(b)});var d=a("#proopc-coupon .proopc-input-append").width(),e=a("#proopc-coupon").find("button.proopc-btn").outerWidth(!0);a("#proopc-coupon-code").width(d-e-20).css("margin-right",5)},ProOPC.selectwidth=function(){a(".proopc-bt-address select, .proopc-st-address select, .proopc-additional-info select, .proopc-confirm-order select").each(function(){a(this).css("width","");var b=a(this).parent(".inner").width();a(this).outerWidth(b-3)}),a(".proopc-register-login select").each(function(){a(this).css("width","");var b=a(this).parent(".proopc-input").width();a(this).outerWidth(b-27)})},ProOPC.productdetails=function(){return!!a(".proopc-cart-product").length&&(ProOPC.pluginLoaded("hoverIntent")?void a(".proopc-cart-product").each(function(){var b=this,c=a(b).data("details"),c=a("#"+c),d=a("table.proopc-p-info-table",c);a(b).hoverIntent({interval:100,sensitivity:6,timeout:100,over:function(){a(b).addClass("open"),a(d).width(a(b).width()),a(c).show().css("top",a(b).position().top).animate({opacity:1,top:a(b).position().top+a(b).height()},150,"linear")},out:function(){a(b).removeClass("open"),a(c).animate({opacity:0},100,"linear",function(){a(this).hide().css("top",0)})}})}):(console.warn("jQuery.hoverIntent plugin is not loaded. Product mouseover effect is being disabled to avoid errors."),!1))},ProOPC.tooltip=function(){var b=a.now(),c=a("<div />",{class:"tooltip-title"}),d=a("<div />",{class:"tooltip-body"}),e=a("<p />",{class:"proopc-tooltip"});a(".hover-tootip").each(function(f){var g=a(this).attr("title");g&&(a(this).attr("data-tiptext",g).removeAttr("title"),a(this).data("uniqueid","proopc-tip-"+b+"-key-"+f)),a(this).hover(function(b){b.stopPropagation();var f=a(this).data("uniqueid"),g=a(this).attr("data-tiptext"),h=null,i=null;if(f&&g){if(!a("#"+f).length){if(g.indexOf("::")>=0){var j=g.split("::");h=j[0],i=j[1]}else h=null,i=g;i&&(e.html("").attr("id",f),h&&e.append(c.html(h)),e.append(d.html(i)).appendTo("body"))}a("#"+f).addClass("show")}},function(){var b=a(this).data("uniqueid");b&&a("#"+b).length&&(a("#"+b).removeClass("show"),setTimeout(function(){a("#"+b).remove()},180))}).mousemove(function(b){var c=a(this).data("uniqueid");if(c&&a("#"+c).length){var d=a("#"+c),e=d.outerWidth(),f=d.outerHeight(),g=a(this).outerHeight();d.css({top:b.pageY-(f+g+2),left:b.pageX-e/2})}})})},ProOPC.fieldTip=function(){a(".hasFieldTip").hover(function(){a(this).attr("title")&&ProOPC.showFieldTip(this)},function(){ProOPC.removeFieldTip(this,!0)})},ProOPC.showFieldTip=function(c){var d=a(c),e="field-tip-"+a.now(),f=a(c).attr("title"),g=a(c).outerWidth(),h=a(c).offset();if(!d.data("tip")){d.data("tipText",f).data("tip","#"+e).removeAttr("title");var i=a("<p />",{id:e,class:"proopc-fieldtip",style:"margin: 0px;"}),j=a("<div />",{class:"fieldtip-body"}).html(f);i.html(j).css("visibility","hidden").appendTo("body");var k=i.outerWidth(),l=i.outerHeight(),m=h.top-(l+6),n=h.left+(g-k)/2;i.css({top:m,left:n,visibility:""}).fadeIn(200),a(b).resize(function(){var a;a&&clearTimeout(a),a=setTimeout(function(){g=d.outerWidth(),h=d.offset(),k=i.outerWidth(),l=i.outerHeight(),m=h.top-(l+6),n=h.left+(g-k)/2,i.css({top:m,left:n})},200)}),d.is(":hidden")&&ProOPC.removeFieldTip(c,!0),a('input[name="proopc-method"][type="radio"]').change(function(){ProOPC.removeFieldTip(c,!0)})}},ProOPC.removeFieldTip=function(b,c){var d=a(b),e=d.data("tip");e&&a(e).length&&(c&&d.attr("title",d.data("tipText")),d.data("tip",null),a(e).animate({opacity:0},200,function(){a(this).remove()}))},ProOPC.setStyle=function(){var c=0,d=".proopc-register > .proopc-inner, .proopc-login > .proopc-inner";a(d).css("min-height","").each(function(){a(this).outerHeight()>c&&(c=a(this).outerHeight())}),c>0&&a(d).css("min-height",c);var e=a("#ProOPC #dynamic_recaptcha_1 table:visible");if(e.length){var f=e.width(),g=e.closest(".proopc-input"),h=g.siblings(".proopc-input-group-level");g.width(f);var i=a(".proopc-register > .proopc-inner").width()-35;h.width(i-f)}var j,k;if(a("table.cart-summary.proopc-table-striped td").each(function(){j=a(this).text(),j=j?a.trim(j):"",k=a(this).html(),k=k?a.trim(k):"",(j&&j.length||k&&k.length)&&!a(this).is(":empty")||a(this).addClass("cell-empty")}),a("table.cart-summary.proopc-table-striped span.vm-price-desc").each(function(){j=a(this).text(),j=j?a.trim(j):"",k=a(this).html(),k=k?a.trim(k):"",(j&&j.length||k&&k.length)&&!a(this).is(":empty")||a(this).hide()}),a(".proopc-p-price > div, .proopc-taxcomponent > div, .proopc-p-discount > div").each(function(){a(this).is(":visible")&&a(this).css("display","inline")}),a(".proopc-login-message-cont").hover(function(){a(".proopc-logout-cont").removeClass("hide")},function(){a(".proopc-logout-cont").addClass("hide")}),a(".proopc-logout-cont").css("min-width",a(".proopc-loggedin-user").width()),a('[data-vpopc="redirect"]').off("click").on("click",function(c){c.preventDefault();var d=a(this).attr("href"),d=d?d.replace("#",""):null,e=a(this).data("vphref");if(d){var f=a("<input />",{type:"hidden",name:"ctask",value:d});a("<form />",{action:VPOPC._("URI"),method:"post"}).html(f).appendTo("body").submit()}else e&&(b.location.href=e);return!1}),"undefined"!=typeof b.bonusCartItemIds&&"undefined"!=typeof b.bonusCartItemIds&&a.each(b.bonusCartItemIds,function(b,c){if(!c.userCanUpdateQuantity){var d=a('input[data-vpid="'+c.cartItemId+'"]').parent(".proopc-input-append"),e=a(d).children('input[name="quantity"]').val();a(d).hasClass("bonusSet")||(d.before(e),a(d).addClass("bonusSet")),d.hide(),d.parent().find("button.remove_from_cart").hide()}}),VPOPC._("STYLERADIOCHEBOX")){var l;a('#UserRegistration input[type="radio"], #EditBTAddres input[type="radio"], #EditSTAddres input[type="radio"]').each(function(){a(this).css({width:"auto",float:"left"}),l=a(this).attr("id"),l&&a('label[for="'+l+'"]').addClass("proopc-radio-label")}),a('#UserRegistration input[type="checkbox"], #EditBTAddres input[type="checkbox"], #EditSTAddres input[type="checkbox"]').each(function(){a(this).css({width:"auto",float:"left",margin:"4px 5px 0 0"}).parent(".proopc-input-append").css("padding-top","4px").siblings("br").remove(),l=a(this).attr("id"),l&&a('label[for="'+l+'"]').css({float:"left","padding-left":"10px","padding-right":"10px"}).insertAfter(this)})}if(a(".proopc-creditcard-info").each(function(){if(!a(this).closest(".vmpayment_cardinfo").length){var b=a(this).prevAll('input[name="virtuemart_paymentmethod_id"]');if(b.length){var c=b.data("pmtype"),d=b.data("paypalproduct"),e=" hide";c&&(d&&(c+=d),b.is(":checked")&&(e=" show"),a(this).wrap('<span class="vmpayment_cardinfo additional-payment-info '+c+e+'" />'))}}}),"undefined"!=typeof klarna&&"undefined"!=typeof klarna&&ProOPC.callKlarna(),a("#sisow_bank").closest("fieldset").length&&a("#sisow_bank").width(a("#sisow_bank").closest("fieldset").width()),a("#monthinstallments").closest(".proopc-row").length&&a("#monthinstallments").width(a("#monthinstallments").closest(".proopc-row").width()),a(".vmpayment_cardinfo").parent().is("div")&&a(".vmpayment_cardinfo").unwrap(),a('#ProOPC select[name="virtuemart_state_id"], #ProOPC select[name="shipto_virtuemart_state_id"]').on("liszt:updated",function(){var l,b=a(this).attr("id"),c=b&&a("select#"+b).length?a("select#"+b)[0]:this,d=a(c).closest("form"),e=a('select[name="virtuemart_country_id"]',d),f=b?a('label[for="'+b+'"]'):null,g=f&&f.length?f.find(".asterisk"):null,h=a(c).find("optgroup"),i=a(c).find("option:first"),i=i.length&&!i.val()?i:null,j=VPOPC.JText._("COM_VIRTUEMART_LIST_EMPTY_OPTION"),k=a("input#STStateID").val();if(i)if(i.data("selectText"))var j=i.data("selectText");else{var j=i.text();i.data("selectText",j)}e.length||(e=a('select[name="shipto_virtuemart_country_id"]',d)),l=e.val(),l>0&&h.each(function(){a(this).data("forcountry")&&a(this).data("forcountry")!=l?a(this).remove():a("option",this).length?a(this).data("forcountry",l):a(this).remove()}),a(c).removeClass("required"),h&&h.length?(a(c).removeAttr("readonly"),a(c).data("frequired")&&(a(c).attr("required",!0),g&&g.show()),i&&i.text(j),"shipto_virtuemart_state_id"==b&&k>0&&!a(c).val()&&h.find('option[value="'+k+'"]').length&&(h.find('option[value="'+k+'"]').attr("selected",!0),a(c).val(k))):(a(c).removeAttr("required").attr("readonly",!0),g&&g.hide(),i&&i.text(VPOPC.JText._("COM_VIRTUEMART_NONE"))),a(c).trigger("opcvalidate")}),VPOPC._("REMOVEUNNECESSARYLINKS")&&VPOPC._("EDITPAYMENTURI")&&(a("span.vmpayment a").each(function(){var b=a(this).closest("label").siblings(".vmpayment_cardinfo");if(b.length){a("<div />",{class:"proopc-payment-text"}).text(a(this).text()).prependTo(b);a(this).remove()}}),a("#ProOPC a").each(function(){a(this).attr("href")==VPOPC._("EDITPAYMENTURI")&&a(this).remove()})),VPOPC._("TOSFANCY")){if(!ProOPC.pluginLoaded("fancybox"))return console.warn("jQuery.fancybox plugin is not loaded. Terms of Service may not display properly."),!1;var m=a("div#proopc-tos-fancy"),g=m.parent(),n=a.easing&&a.easing.hasOwnProperty("elastic")?"elastic":"fade";a('[data-tos="fancybox"]').fancybox({titlePosition:"inside",padding:0,showCloseButton:!1,centerOnScroll:!0,transitionIn:"fade",transitionOut:n,overlayOpacity:.8,overlayColor:"#000",onClosed:function(){a(this.href).length||(g.html(m),a("div#proopc-tos-fancy button.fancy-close").click(function(b){b.preventDefault(),a.fancybox.close()}))}}),a("div#proopc-tos-fancy button.fancy-close").click(function(b){b.preventDefault(),a.fancybox.close()})}VPOPC._("RELOAD")&&!a("#ProOPC").hasClass("loaded")&&a(".proopc-reload").length&&a("html,body").animate({scrollTop:a("#proopc-system-message").offset().top-100},500,function(){a("#ProOPC").addClass("loaded")});var o=a('input.klarnaPayment[type="radio"]'),p=a("form#proopc-payment-form").find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');o.length&&(o.attr("onclick","return ProOPC.setpayment(this);").closest("table").addClass("proopc-klarna-payment"),p.length&&ProOPC.klarnaOpenClose.call(p[0]))},ProOPC.isMobile=function(){var b=navigator.userAgent.toLowerCase(),c="PC";return b.match(/android/i)?c="Android":b.match(/blackberry/i)?c="BlackBerry":b.match(/iphone/i)?c="iPhone":b.match(/ipad/i)?c="iPad":b.match(/ipod/i)?c="iPod":b.match(/opera mini/i)?c="Opera Mini":b.match(/iemobile/i)?c="IEMobile":b.match(/fban|fbav/i)&&(c="Facebook"),"PC"==c?(a("html").addClass("device-is-pc").removeClass("device-is-handheld"),!1):(a("html").addClass("device-is-handheld").removeClass("device-is-pc"),c)},ProOPC.klarnaOpenClose=function(b){if(!a(this).hasClass("klarnaPayment"))return!1;var c=this,d=a(c).closest("proopc-klarna-payment"),e=a(".klarna_box_bottom_right .klarna_box_bottom_content .btn-additional-klarna",d),f=0;d.siblings().find(".klarna_box_bottom:visible").hide(),a('.proopc-klarna-payment input[name="klarna_paymentmethod"]').attr("disabled",!0),a('input[name="klarna_paymentmethod"]',d).removeAttr("disabled"),a(".klarna_box_bottom:hidden",d).css("opacity",0).show(),a('input[type="text"]',d).width("auto"),a('input[type="text"]:visible').each(function(){f=a(this).parent("div").width(),f&&a(this).css("max-width",f-13)}),a(".proopc-klarna-payment .klarna_box_bottom_input_combo").each(function(){a(this).children("div").width("100%")}),e.length||(e=a("<button />",{type:"button",class:"proopc-btn btn-additional-klarna",onclick:"return ProOPC.setpayment(this);",style:"margin-top: 15px;"}).text(VPOPC.JText._("COM_VIRTUEMART_SAVE")),a(".klarna_box_bottom_right .klarna_box_bottom_content",d).append(e)),a("div.klarna_box_bottom_title:visible, div.klarna_box_bottom_title:visible",d).removeAttr("style"),a("#box_klarna_consent_invoice:visible",d).parent("div").addClass("proopc-klarna-consent-container").width("auto"),a("#box_klarna_consent_part:visible",d).parent("div").addClass("proopc-klarna-consent-container").width("auto"),a(".klarna_box_bottom:visible",d).animate({opacity:1},300)},ProOPC.callKlarna=function(){var b=a("body");a("#klarna_baloon").clone(),a("#klarna_blue_baloon").clone();if(a(".klarna_baloon, .klarna_blue_baloon",b).remove(),"undefined"!=typeof klarna&&"undefined"!=typeof klarna){if("undefined"!==klarna.doDocumentIsReady&&"function"===a.type(klarna.doDocumentIsReady)&&klarna.doDocumentIsReady(a(".klarna_box")),!klarna.unary_checkout){var e=a('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');klarna.gChoice="",e.hasClass("klarnaPayment")&&(klarna.stype=e.data("stype"),klarna.gChoice=e.attr("id")),e.length&&ProOPC.klarnaOpenClose.call(e[0])}klarna.baloons_moved=!0}},ProOPC.getKlarnaForm=function(){var b=a('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');if(!b.hasClass("klarnaPayment"))return!1;var f,c=b.closest("table"),d=c.find("*").serializeArray(),e=a("<form />");return d.push({name:"task",value:"setpayment"}).push({name:"view",value:"cart"}).push({name:"klarna_paymentmethod",value:selectedPayment.next("input").val()}),a.each(d,function(b,c){f=a("<input />",{type:"hidden",name:c.name,value:c.value}),e.append(f)}),e},ProOPC.setPreloaderState=function(b){var c=a("#proopc-preloader");"init"==b?a(c).addClass("proopc-started"):(setTimeout(function(){a(c).addClass("proopc-loaded").removeClass("proopc-started")},100),setTimeout(function(){a(c).remove()},600))},ProOPC.canCheckout=function(){if(!a("#ProOPC").length)return!1;var b=a("#ProOPC")[0];a(b).hasClass("emptyCart-view")?ProOPC.setPreloaderState("done"):(ProOPC._canCheckoutTask.call(b,!0),setInterval(function(){ProOPC._canCheckoutTask.call(b,!1)},9e5))},ProOPC._canCheckoutTask=function(c){var d=this;ProOPC.ajax("cancheckout",{beforeSend:function(){c&&ProOPC.setPreloaderState("init")},success:function(e){return"object"!==a.type(e)?(a(d).removeClass("canCheckout"),b.location.reload(!0),!1):(c&&ProOPC.setPreloaderState("done"),void(e.error?(a(d).removeClass("canCheckout"),e.reload&&ProOPC._reload()):a(d).addClass("canCheckout")))},errorCallback:function(){c&&ProOPC.setPreloaderState("done")}})},ProOPC.validateAllForms=function(){var b=a("form#EditBTAddres"),c=a("form#EditSTAddres"),d=a("#proopc-shipments"),e=a("#proopc-payments"),f=a("form#proopc-payment-form"),g=a("form#cartFormFields"),g=g&&g.length?g:a("form#checkoutForm"),h=g.find('input[name="tos"][type="checkbox"]'),i=a("#proopc-entry-single"),j=a('input#STsameAsBT[type="checkbox"]').length&&a('input#STsameAsBT[type="checkbox"]').is(":checked");if(i.length){var k=a('input[name="proopc-method"][type="radio"]',i),l=a('input[name="proopc-method"][value="guest"][type="radio"]',i);if(!k.length)return ProOPC.setmsg(1,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_LOGIN_NEEDED")),!1;if(!l.length)return ProOPC.setmsg(1,VPOPC.JText._("PLG_VPONEPAGECHECKOUT_ONLY_REGISTERED_USER_CAN_CHECKOUT")),!1;l.attr("checked",!0).trigger("change")}if(!ProOPC._validateAddressForms.call(b))return ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1;if(!j&&!ProOPC._validateAddressForms.call(c))return ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1;if(d.length&&!a('input[name="virtuemart_shipmentmethod_id"][type="radio"]',d).is(":checked"))return ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_CART_NO_SHIPMENT_SELECTED")),!1;if(e.length&&!a('input[name="virtuemart_paymentmethod_id"][type="radio"]',e).is(":checked"))return ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_CART_NO_PAYMENT_SELECTED")),!1;var m=a('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked',f);if(m.length&&m.hasClass("klarnaPayment")){var q,n=m.closest("table"),o=!1,p=[];a("input, select, textarea, .klarna_box_bottom_title",n).removeClass("invalid"),a("input:visible",n).not(":checkbox").each(function(){a(this).val()||(a(this).addClass("invalid").prev(".klarna_box_bottom_title").addClass("invalid"),q=a(this).prev(".klarna_box_bottom_title").text(),q&&p.push(q),o=!0)});var r=!1;if(a("select",n).each(function(){var b=a(this).val();b&&""!=parseInt(b)&&0!=parseInt(b)&&!isNaN(parseInt(b))||(a(this).addClass("invalid"),a(this).closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").addClass("invalid"),q=a(this).closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").text(),q&&!r&&(p.push(q),r=!0),o=!0)}),a('input[type="checkbox"]',n).each(function(){a(this).is(":checked")||(a(this).addClass("invalid").next(".klarna_box_bottom_title").addClass("invalid"),p.push("Klarna: "+VPOPC.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS")),o=!0)}),a("input, select, textarea",n).change(function(){a(this).is("input")&&""!=a(this).val()&&a(this).removeClass("invalid").prev(".klarna_box_bottom_title").removeClass("invalid"),!a(this).is("select")||""==a(this).val()&&"0"==a(this).val()||a(this).removeClass("invalid").closest(".klarna_box_bottom_input_combo").prev(".klarna_box_bottom_title").removeClass("invalid"),a(this).is('input[type="checkbox"], input[type="radio"]')&&a(this).is(":checked")&&a(this).removeClass("invalid").next(".klarna_box_bottom_title").removeClass("invalid")}),o&&p.length)return ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")+": "+p.join(", ")+"."),!1}if(h.length&&h.attr("required")&&!h.is(":checked")){var s=h.data("label"),s=s?s:VPOPC.JText._("COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS");return ProOPC.setmsg(1,s),!1}return!!ProOPC._validateAddressForms.call(g)||(ProOPC.setmsg(1,VPOPC.JText._("COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS")),!1)},ProOPC._validateAddressForms=function(){return a("input, select, textarea",this).each(function(){a(this).attr("id");a(this).off("opcvalidate").on("change opcvalidate",function(){if(a(this).attr("required")||a(this).hasClass("required")){a(this).attr("required",!0);var b=a(this).val(),c=a(this).attr("name"),d=a(this).closest("form");if(b?ProOPC._updateAddressFieldState.call(this,!0):ProOPC._updateAddressFieldState.call(this,!1),b&&b.length&&("email"==c||"shipto_email"==c||"verify_email"==c)&&(b=a.trim(b),a(this).val(b),"email"!=c&&"shipto_email"!=c||(ProOPC.validateEmail(b)?d.find('input[name="verify_email"]').trigger("change"):ProOPC._updateAddressFieldState.call(this,!1)),"verify_email"==c)){var e=d.find('input[name="email"]').val();e&&b!=e&&ProOPC._updateAddressFieldState.call(this,!1)}}else ProOPC._updateAddressFieldState.call(this,!0)})}).trigger("opcvalidate"),!(a(this).find("input.invalid").length||a(this).find("select.invalid").length||a(this).find("textarea.invalid").length)},ProOPC._updateAddressFieldState=function(b){var c=a(this).attr("id"),d=a(this).closest("form"),b=ProOPC.hasValue(b);b?(a(this).removeClass("invalid"),c&&a('label[for="'+c+'"]',d).length&&a('label[for="'+c+'"]',d).removeClass("invalid")):(a(this).addClass("invalid"),c&&a('label[for="'+c+'"]',d).length&&a('label[for="'+c+'"]',d).addClass("invalid"))},ProOPC.close=function(b){a(b).parent(".proopc-alert").remove()},ProOPC.checkForError=function(b){if(b&&"object"===a.type(b)){if("undefined"==typeof b.error||!b.error)return!0;ProOPC.getcartlist(),ProOPC.removePageLoader(),ProOPC.enableSubmit();var c="A system error was generated while processing your order request. Please try again later.";"undefined"!=typeof b.msg&&b.msg&&(c=b.msg),ProOPC.ajaxManager.setContinuous(!1),ProOPC.setmsg(1,c)}else{var d=this.hasOwnProperty("error")?this.error:null;ProOPC.ajaxManager.setContinuous(!1),
d&&"function"===a.type(d)&&d.call(this)}return!1},ProOPC.commonError=function(){ProOPC.removePageLoader(),ProOPC.enableSubmit();var a="A system error was generated while processing your order request. Please check console log more details.";ProOPC.setmsg(1,a)},ProOPC.submitOrder=function(c,d){if(d=ProOPC.hasValue(d),!d||1==d){if(a("#proopc-system-message").html(""),!ProOPC.validateAllForms())return!1;ProOPC.ajaxManager.setContinuous(!0),ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS"),ProOPC.disableSubmit(),ProOPC.ajaxManager.addReq({data:"ctask=savebtaddress&stage=final&"+a("form#EditBTAddres").serialize()+"&"+ProOPC.getToken(),beforeSend:function(){ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS"),ProOPC.disableSubmit()},success:function(a){return!!ProOPC.checkForError.call(this,a)&&(ProOPC._triggerEvent("checkout.bt.saved"),ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_BILLING_ADDRESS_SAVED"),void ProOPC.submitOrder(c,2))},error:ProOPC.commonError},"savebtaddress")}if(2==d){var e=a('#ProOPC input#STsameAsBT[type="checkbox"]'),f=a('#proopc-hidden-confirm input[name="STsameAsBT"]:hidden'),g=a('#proopc-hidden-confirm input[name="shipto"]:hidden');if(e.length&&e.is(":checked"))return a(f).val(1),a(g).val(-1),ProOPC.submitOrder(c,3),!1;a(f).val(0),a(g).val(0),ProOPC.ajaxManager.addReq({data:"ctask=savestaddress&stage=final&"+a("form#EditSTAddres").serialize()+"&"+ProOPC.getToken(),beforeSend:function(){ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_SHIPPING_ADDRESS"),ProOPC.disableSubmit()},success:function(b){return!!ProOPC.checkForError.call(this,b)&&(a(g).val(b.userinfo_id),ProOPC._triggerEvent("checkout.st.saved"),ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_SHIPPING_ADDRESS_SAVED"),void ProOPC.submitOrder(c,3))},error:ProOPC.commonError},"savestaddress")}if(3==d&&ProOPC.ajaxManager.addReq({data:"ctask=setpayment&ajax=1&savecc=1&finalise=1&"+a("form#proopc-payment-form").serialize()+"&"+ProOPC.getToken(),beforeSend:function(){ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_SAVING_CREDIT_CARD"),ProOPC.disableSubmit()},success:function(d,e,f){if(f.getResponseHeader("content-type").indexOf("text/html")>=0&&"undefined"!=typeof klarna){ProOPC.removePageLoader(),a("#proopc-order-process").remove(),a("<div />",{id:"proopc-temp",style:"display:none"}).appendTo("body"),a("#proopc-temp").append(d);var g=a("#proopc-temp").find("div#system-message-container").html();return ProOPC.setmsg(1,g),ProOPC.enableSubmit(),!1}return"string"==typeof d&&(d=a.parseJSON(d)),!!ProOPC.checkForError.call(this,d)&&void(0!=d.redirect?b.location=d.redirect:(ProOPC._triggerEvent("checkout.paymentmethod.saved"),ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED"),ProOPC.submitOrder(c,4)))},error:ProOPC.commonError},"setpayment"),4==d){var h=a("form#checkoutForm").serialize();a("form#cartFormFields").length&&(h+="&"+a("form#cartFormFields").serialize()),ProOPC.ajaxManager.addReq({data:"ctask=savecartfields&"+h,beforeSend:function(){ProOPC.disableSubmit()},success:function(a,b,d){return!!ProOPC.checkForError.call(this,a)&&(ProOPC._triggerEvent("checkout.cartfields.saved"),void ProOPC.submitOrder(c,5))},error:ProOPC.commonError},"savecartfields")}if(5==d&&ProOPC.ajaxManager.addReq({data:"ctask=verifycheckout",beforeSend:function(){ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_VERIFYING_ORDER"),ProOPC.disableSubmit()},success:function(a,b,d){return ProOPC.checkForError.call(this,a)?(ProOPC._triggerEvent("checkout.orderVerification.success"),void ProOPC.submitOrder(c,6)):(ProOPC._triggerEvent("checkout.orderVerification.failed"),!1)},error:ProOPC.commonError},"verifycheckout"),6==d||"confirm"==d){ProOPC.addPageLoader("PLG_VPONEPAGECHECKOUT_PLACING_ORDER");var i=a("form#checkoutForm");a(i).append(a("#proopc-hidden-confirm").html()),setTimeout(function(){a(i).submit()},100)}return!1},a(function(){ProOPC.isMobile(),ProOPC.init(!0),ProOPC.initSpinner(),ProOPC.ajaxManager.run(),ProOPC.canCheckout(),ProOPC.setStyle(),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.bindFormValidator(),ProOPC.productdetails(),ProOPC.tooltip(),ProOPC.fieldTip(),ProOPC.defaultSP(),a(b).on("proopc:saferesize",function(a,b){ProOPC.setStyle(),ProOPC.inputwidth(),ProOPC.selectwidth()}),a(c).ajaxStop(function(){ProOPC.init(),ProOPC.enableMethodSelection()}),a(c).ajaxError(function(){ProOPC.enableMethodSelection()}),a(b).load(function(){ProOPC.setStyle()})}),b.addEventListener("orientationchange",function(){a(b).trigger("proopc:checkorientation")},!1),a(b).on("resize proopc:checkorientation",function(c){(c.type&&"proopc:checkorientation"===c.type||!ProOPC.isMobile())&&(ProOPC.cache.resizeTimeout&&clearTimeout(ProOPC.cache.resizeTimeout),ProOPC.cache.resizeTimeout=setTimeout(function(){a(b).trigger("proopc:saferesize",[c])},100))})}(ProOPC.jQuery,window,document);